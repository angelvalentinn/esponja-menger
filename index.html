<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Esponja de Menger</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.3.1/p5.min.js"></script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Contenedor main -->
    <main id="container">
      <!-- Aquí se ubicará el canvas -->
      <h1>
        <p>
          ¡¿Esperabas ver el Nivel 3?! Bueno, llegamos hasta acá para que lo calcules vos... ¿Cuántos cubos tiene este Nivel? Si tenés paciencia y demasiado tiempo... ¡podés armarlo también!
        </p>

        <p>
          Los saluda Karina y Rocío. 
        </p>
        <p>
          ISFD N°11. GEOMETRÍA NO EUCLIDEANA. 
        </p>
        <p>
          Profesor: Rivolta.
        </p>
      </h1>
    </main>

    <div>
      <button aria-level="0">Nivel 0</button>
      <button aria-level="1">Nivel 1</button>
      <button aria-level="2">Nivel 2</button>
      <button aria-level="3">Nivel 3</button>
    </div>

    <script>
      const main = document.querySelector("#container");
      const btns = document.querySelectorAll("button");
      const h1 = document.querySelector("h1");

      let cubos = [new Cubo(0, 0, 0, 200)];
      let maxGeneraciones = 3;
      let rotacionX = 0;
      let rotacionY = 0;
      let tamCubo = 280;
      let canvaHeight = 550;
      let canvaWidth = 550;

      btns.forEach((btn) => {

        btn.addEventListener("click", (e) => {
          if (btn.ariaLevel == "0") {
            maxGeneraciones = 0;
            h1.style.display = 'none';
          } else if (btn.ariaLevel == "1") {
            maxGeneraciones = 1;
            h1.style.display = 'none';
          } else if (btn.ariaLevel == "2") {
            maxGeneraciones = 2;
            h1.style.display = 'none';

          } else if(btn.ariaLevel == '3'){
            h1.style.display = 'block';
          } 

          setup(maxGeneraciones, btn.ariaLevel);

        });
      });

      function setup(maxGeneraciones, level) {
        // Crea el canvas y lo ubica dentro del contenedor con ID "container"
        
        let canvas = createCanvas(canvaHeight, canvaWidth, WEBGL);
        if(level != "3") {
          cubos = [new Cubo(0, 0, 0, tamCubo)];
          canvas.parent("container"); // Asocia el canvas al elemento main con ID "container"

          frameRate(30); // Limitar FPS para mejorar rendimiento
          for (let i = 0; i < maxGeneraciones; i++) {
            siguienteGeneracion();
          } 
        } else {
          canvas.remove()
        }
      }

      function draw() {
        background("lightgray");
        fill("#b925b9");
        
        stroke(0);         // Color del borde para las divisiones
        strokeWeight(.5); 
        translate(0, -20, 0);

        // Mapeo del cursor para rotar el cubo basado en la posición del mouse
        main.addEventListener("mousemove", () => {
          rotacionX = map(mouseY, 0, height, -PI, PI);
          rotacionY = map(mouseX, 0, width, -PI, PI);
        });

        // Mapeo del cursor para rotar el cubo basado en la posición del dedo en la pantalla
        main.addEventListener("touchmove", () => {
          rotacionX = map(mouseY, 0, height, -PI, PI);
          rotacionY = map(mouseX, 0, width, -PI, PI);
        });

        rotateX(rotacionX);
        rotateY(rotacionY);

        lights();
        directionalLight(color("blue"), 0, -1, 0);

        // Dibujar cubos
        for (const cubo of cubos) {
          cubo.dibujar();
        }
      }

      function siguienteGeneracion() {
        let fracciones = [];
        for (const cubo of cubos) {
          fracciones = fracciones.concat(cubo.fraccionar());
        }
        cubos = fracciones;
      }

      function Cubo(x, y, z, lado) {
        this.x = x;
        this.y = y;
        this.z = z;
        this.lado = lado;

        this.dibujar = function () {
          push();
          translate(this.x, this.y, this.z);
          box(this.lado);
          pop();
        };

        this.fraccionar = function () {
          let fracciones = [];
          for (let x = -1; x <= 1; x++) {
            for (let y = -1; y <= 1; y++) {
              for (let z = -1; z <= 1; z++) {
                if (sqrt(x * x + y * y + z * z) <= 1) {
                  continue; // Evitar cubos interiores
                }
                fracciones.push(
                  new Cubo(
                    this.x + (x * this.lado) / 3,
                    this.y + (y * this.lado) / 3,
                    this.z + (z * this.lado) / 3,
                    this.lado / 3
                  )
                );
              }
            }
          }
          return fracciones;
        };
      }
    
    </script>
  </body>
</html>
